import Rails from 'rails-ujs';
import "script-loader!<%= Rails.root.join('vendor', 'assets', 'javascript', 'instascan.min.js') %>";

var openCameraButton = document.getElementById('open-camera');
var openListButton = document.getElementById('open-list');
var switchCameraButton = document.getElementById('switch-camera');
var cameraList;
var camIdx = 0;

var scanner = new Instascan.Scanner({
	video: document.getElementById('qr-video'),
	mirror: false,
	backgroundScan: false
});

init();

function init() {
	cameraList = Instascan.Camera.getCameras().then(function(cameras) {
		cameraList = cameras;
	}).catch(function(e){
		console.error(e);
	});

	openCameraButton.addEventListener('click', function() {
		if(cameraList.length > 0) {
			scanner.start(cameraList[0]);
		} else {
			console.error('No cameras found.');
		}
	});

	if(cameraList.length > 1) {
		switchCameraButton.classList.remove('is-hidden');
		switchCameraButton.addEventListener('click', function() {
			scanner.stop().then(function() {
				camIdx = (camIdx + 1) % cameraList.length;
				scanner.start(cameraList[camIdx]);
			});
		});
	}

	scanner.addListener('scan', function(content) {
		var input = document.getElementById('ticket_token_code');
		input.value = content;
	});

	openListButton.addEventListener('click', function() {
		scanner.stop();
	});
}

window.onload = function() {
    var tablinks = document.getElementsByClassName("tablinks");
    tablinks[0].click();
}
