<%= form_for @order_form, url: orders_path do |f| %>
  <%= f.hidden_field :event_id, value: @order_form.event_id %>
  <div class="columns is-multiline">
    <% if current_user.nil? %>
      <div class="column is-12">
        <label class="label is-inline-block">Cadastro&nbsp;</label><span class="is-inline-block"><%= link_to "Já é cadastrado? Faça o login.", login_path(redirect_to: request.url), class: 'help' %></span>
        <div class="columns is-multiline has-background-light">
          <%= fields_for @user do |user| %>
            <div class="column is-12">
              <div class="field">
                <label class="label is-inline-block">Nome completo</label>
                <div class="control">
                  <%= user.text_field :name, autofocus: true, autocomplete: "name", class: "input", placeholder: "Seu nome" %>
                </div>
              </div>
            </div>
            <div class="column is-6">
              <div class="field">
                <label class="label is-inline-block">Email</label>
                <div class="control">
                  <%= user.email_field :email, autocomplete: "email", class: "input email", placeholder: "nome@exemplo.com" %>
                </div>
              </div>
            </div>
            <div class="column is-6">
              <div class="field">
                <label class="label is-inline-block">Senha</label><span class="help is-inline-block"> Mínimo de 8 caracteres</span>
                <div class="control">
                  <%= user.password_field :password, autocomplete: "new-password", class: "input", placeholder: "********" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <%= f.fields_for :payment do |payment_f| %>
      <div class="column is-6">
        <div class="field">
          <label class="label is-inline-block">Nome completo</label><span class="help is-inline-block"> Como impresso no cartão</span>
          <div class="control">
            <%= payment_f.text_field :holder_fullname, autofocus: true, class: "input" %>
          </div>
        </div>
      </div>
      <div class="column is-6">
        <div class="field">
          <label class="label">Opções de pagamento</label>
          <div class="control is-expanded">
            <div class="select is-fullwidth">
              <%= payment_f.select :installment_count do %>
                <% (1..12).each do |index| %>
                  <%= content_tag :option, installment_info(index), value: index, data: { price: price_with_interest(index) } %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div class="column is-12 cards-label">
        <label class="label is-hidden-desktop">Informações do cartão</label>
        <div class="level is-mobile" style="margin-bottom: 0.75rem;">
          <div class="level-left is-hidden-touch">
            <div class="level-item">
              <label class="label">Informações do cartão</label>
            </div>
          </div>
          <div class="level-right cards">
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/visa.svg"), alt:'Visa', width:'36rem', id: 'visa' %>
            </div>
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/mastercard.svg"), alt:'Visa', width:'36rem', id: 'mastercard' %>
            </div>
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/amex.svg"), alt:'Visa', width:'36rem', id: 'amex' %>
            </div>
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/elo.svg"), alt:'Visa', width:'36rem', id: 'elo' %>
            </div>
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/hiper.svg"), alt:'Visa', width:'36rem', id: 'hiper' %>
            </div>
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/diners.svg"), alt:'Visa', width:'36rem', id: 'dinersclub' %>
            </div>
            <div class="level-item">
              <%= image_tag asset_pack_path("media/application/images/cards/hipercard.svg"), alt:'Visa', width:'36rem', id: 'hipercard' %>
            </div>
          </div>
        </div>
      </div>
        
      <div class="column is-6 no-top-pad">
        <div class="field">
          <%= payment_f.hidden_field :hash %>
          <div class="control">
            <input id="card-number" class="input" type="number" placeholder="Número do cartão">
            <span class="help checkout is-danger is-hidden">Número de cartão inválido.</span>
          </div>
        </div>
      </div>
      <div class="column is-6 no-top-pad">
        <div class="field has-addons">
          <div class="control is-expanded">
            <input id="expiration-date" class="input" type="text" placeholder="Validade">
          </div>
          <div class="control">
            <input id="cvc" class="input" type="number" placeholder="CVV">
          </div>
        </div>
      </div>

      <div class="column is-6">
        <div class="field">
          <label class="label">CPF</label>
          <div class="control">
            <%= payment_f.text_field :holder_document, class: "input", maxlength: "14" %>
          </div>
        </div>
      </div>
      <div class="column is-6">
        <div class="field">
          <label class="label">Telefone celular</label>
          <div class="control">
            <%= payment_f.text_field :holder_phone, id: "phone", class: "input", maxlength: "16" %>
          </div>
        </div>
      </div>
      <div class="column is-6">
        <div class="field">
          <div class="control">
            <label class="label">Data de Nascimento</label>
            <div class="select">
              <%= payment_f.date_select :holder_birthdate, date_separator: "</div>&nbsp;<div class='select'>", start_year: Date.today.year, end_year: Date.today.year-100, prompt: {day: 'Dia', month: 'Mês', year: 'Ano'} %>
            </div>
          </div>
        </div>
      </div>
      <%= payment_f.fields_for :billing_address do |address_f| %>
        <div class="column is-6">
          <div class="field">
            <label class="label">CEP</label>
            <div class="control">
              <%= address_f.text_field :zipcode, class: "input", maxlength: "9" %>
            </div>
          </div>
        </div>

        <div class="column is-12 is-hidden" id="address">
          <div class="columns is-multiline">
            <div class="column is-6">
              <div class="field">
                <label class="label">Endereço</label>
                <div class="control">
                  <%= address_f.text_field :address, class: "input" %>
                </div>
              </div>
            </div>
            <div class="column is-3">
              <div class="field">
                <label class="label">Número</label>
                <div class="control">
                  <%= address_f.text_field :number, class: "input" %>
                </div>
              </div>
            </div>
            <div class="column is-3">
              <div class="field">
                <label class="label">Complemento</label>
                <div class="control">
                  <%= address_f.text_field :complement, class: "input", placeholder: "Opcional" %>
                </div>
              </div>
            </div>
            <div class="column is-4">
              <label class="label">Bairro</label>
              <div class="control">
                <%= address_f.text_field :district, class: "input" %>
              </div>
            </div>
            <div class="column is-5">
              <div class="field">
                <label class="label">Cidade</label>
                <div class="control">
                  <%= address_f.text_field :city, class: "input" %>
                </div>
              </div>
            </div>
            <div class="column is-3">
              <div class="field">
                <label class="label">Estado</label>
                <div class="control">
                  <%= address_f.text_field :state, class: "input" %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>

    <div class="column is-12 is-paddingless">
      <hr />
    </div>
    <% index = 0 %>
    <%= f.fields_for :order_items, f.object.order_items do |order_item_f| %>
      <%= order_item_f.hidden_field :offer_id, value: order_item_f.object.offer_id %>
      <%= order_item_f.hidden_field :quantity, value: order_item_f.object.quantity %>
        <%= order_item_f.fields_for :ticket_tokens, order_item_f.object.ticket_tokens do |ticket_token_f| %>
          <div class="column is-12 ticket-label">
            <label class="label is-inline-block">Ingresso n
              <span class="numr">0</span><%= index += 1 %>
            </label>
            <span class="is-inline-block">-> <%= order_item_f.object.offer_name %></span>
          </div>
          <div class="column is-6">
            <div class="field">
              <label class="label">Quem vai usar?</label>
              <div class="control">
                <%= ticket_token_f.text_field :owner_name, class: "input" %>
              </div>
            </div>
          </div>
          <div class="column is-6">
            <div class="field">
              <label class="label">E-mail </label>
              <div class="control">
                <%= ticket_token_f.email_field :owner_email, class: "input email" %>
              </div>
            </div>
          </div>
        <% end %>
    <% end %>
    <div class="column is-12">
      <hr />
      <p class="help">Eu concordo com o <%= link_to "Termos de Uso", terms_path, target: "_blank" %>, <%= link_to "Política de Cancelamento", terms_path, target: "_blank" %> e a <%= link_to "Política de Privacidade", privacy_path, target: "_blank" %>. Também concordo em pagar o valor total exibido, que inclui as taxas de serviço.</p>
      <%= f.button :submit, class:"confirm button is-primary" do %>
        <span>Confirmar e pagar</span>
        <span class="icon is-small">
          <i class="fas fa-lock"></i>
        </span>
      <% end %>
    </div>
  </div>
<% end %>