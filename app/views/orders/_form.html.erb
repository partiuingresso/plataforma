<%= javascript_include_tag params[:controller], defer: true %>
<%= form_for @order do |f| %>
  <div class="columns is-multiline">
    <%= fields_for @payment do |payment_f| %>
      <div class="column is-12">
        <div class="field">
          <label class="label is-inline-block">Nome completo</label><span class="help is-inline-block"> Como impresso no cartão</span>
          <div class="control">
            <%= payment_f.text_field :holder_fullname, class: "input" %>
          </div>
        </div>
      </div>
      <div class="column is-12 cards-label">
        <div class="level" style="margin-bottom: 0.75rem;">
          <div class="level-left">
            <div class="level-item">
              <label class="label">Informações do cartão</label>
            </div>
          </div>
          <div class="level-right cards">
            <div class="level-item">
              <%= image_tag 'cards/visa.svg', alt:'Visa', width:'36rem', id: 'visa' %>
            </div>
            <div class="level-item">
              <%= image_tag 'cards/mastercard.svg', alt:'Visa', width:'36rem', id: 'mastercard' %>
            </div>
            <div class="level-item">
              <%= image_tag 'cards/amex.svg', alt:'Visa', width:'36rem', id: 'amex' %>
            </div>
            <div class="level-item">
              <%= image_tag 'cards/elo.svg', alt:'Visa', width:'36rem', id: 'elo' %>
            </div>
            <div class="level-item">
              <%= image_tag 'cards/hiper.svg', alt:'Visa', width:'36rem', id: 'hiper' %>
            </div>
            <div class="level-item">
              <%= image_tag 'cards/diners.svg', alt:'Visa', width:'36rem', id: 'dinersclub' %>
            </div>
            <div class="level-item">
              <%= image_tag 'cards/hipercard.svg', alt:'Visa', width:'36rem', id: 'hipercard' %>
            </div>
          </div>
        </div>
      </div>
        
      <div class="column is-6 no-top-pad">
        <div class="field">
          <%= payment_f.hidden_field :hash %>
          <div class="control">
            <input id="card-number" class="input" type="number" placeholder="Número do cartão">
            <span class="help checkout is-danger is-hidden">Número de cartão inválido.</span>
          </div>
        </div>
      </div>
      <div class="column is-6 no-top-pad">
        <div class="field has-addons">
          <div class="control is-expanded">
            <input id="expiration-date" class="input" type="text" pattern="[0-9]*" placeholder="Validade">
          </div>
          <div class="control">
            <input id="cvc" class="input" type="number" placeholder="CVV">
          </div>
        </div>
      </div>

      <div class="column is-6">
        <div class="field">
          <label class="label">CPF</label>
          <div class="control">
            <%= payment_f.text_field :holder_cpf, class: "input" %>
          </div>
        </div>
      </div>
      <div class="column is-6">
        <div class="field">
          <label class="label">Telefone celular</label>
          <div class="control">
            <%= payment_f.text_field :holder_phone, class: "input" %>
          </div>
        </div>
      </div>
      <div class="column is-6">
        <div class="field">
          <div class="control">
            <label class="label">Data de Nascimento</label>
            <div class="select">
              <%= payment_f.date_select :holder_birthdate, date_separator: "</div>&nbsp;<div class='select'>", start_year: Date.today.year, end_year: Date.today.year-100, prompt: {day: 'Dia', month: 'Mês', year: 'Ano'} %>
            </div>
          </div>
        </div>
      </div>
      <div class="column is-6">
        <div class="field">
          <label class="label">CEP</label>
          <div class="control">
            <%= payment_f.number_field :billing_address_zipcode, class: "input" %>
          </div>
        </div>
      </div>

      <div class="column is-12 address">
        <div class="columns is-multiline">
          <div class="column is-6">
            <div class="field">
              <label class="label">Endereço</label>
              <div class="control">
                <%= payment_f.text_field :billing_address_street, class: "input" %>
              </div>
            </div>
          </div>
          <div class="column is-3">
            <div class="field">
              <label class="label">Número</label>
              <div class="control">
                <%= payment_f.text_field :billing_address_number, class: "input" %>
              </div>
            </div>
          </div>
          <div class="column is-3">
            <div class="field">
              <label class="label">Complemento</label>
              <div class="control">
                <%= payment_f.text_field :billing_address_complement, class: "input", placeholder: "Opcional" %>
              </div>
            </div>
          </div>
          <div class="column is-4">
            <label class="label">Bairro</label>
            <div class="control">
              <%= payment_f.text_field :billing_address_district, class: "input" %>
            </div>
          </div>
          <div class="column is-5">
            <div class="field">
              <label class="label">Cidade</label>
              <div class="control">
                <%= payment_f.text_field :billing_address_city, class: "input" %>
              </div>
            </div>
          </div>
          <div class="column is-3">
            <div class="field">
              <label class="label">Estado</label>
              <div class="control">
                <%= payment_f.text_field :billing_address_state, class: "input" %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <div class="column is-12 is-paddingless">
      <hr />
    </div>
    <% index = 0; @order.order_items.each do |order_item| %>
      <%= f.fields_for :order_items, order_item do |order_item_f| %>
        <%= order_item_f.hidden_field :offer_id, value: order_item.offer.id %>
        <%= order_item_f.hidden_field :quantity, value: order_item.quantity %>
          <% order_item.quantity.times do %>
            <%= order_item_f.fields_for :ticket_tokens do |ticket_token_f| %>
              <div class="column is-12 ticket-label">
                <label class="label is-inline-block">Ingresso n<span class="numr">0</span> <%= index += 1 %></label>
                <span class="is-inline-block">-> <%= order_item.offer.name %></span>
              </div>
              <div class="column is-6">
                <div class="field">
                  <label class="label">Quem vai usar?</label>
                  <div class="control">
                    <%= ticket_token_f.text_field :owner_name, class: "input" %>
                  </div>
                </div>
              </div>
              <div class="column is-6">
                <div class="field">
                  <label class="label">E-mail </label>
                  <div class="control">
                    <%= ticket_token_f.email_field :owner_email, class: "input" %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
      <% end %>
    <% end %>
    <div class="column is-12">
      <hr />
      <p class="help">Eu concordo com o <%= link_to "Termos de Uso", terms_path, target: "_blank" %>, <%= link_to "Política de Cancelamento", terms_path, target: "_blank" %> e a <%= link_to "Política de Privacidade", privacy_path, target: "_blank" %>. Também concordo em pagar o valor total exibido, que inclui as taxas de serviço.</p>
      <%= f.button :submit, class:"confirm button is-primary" do %>
        <span>Confirmar e pagar</span>
        <span class="icon is-small">
          <i class="fas fa-lock"></i>
        </span>
      <% end %>
    </div>
  </div>
<% end %>